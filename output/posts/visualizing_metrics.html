<html>
  <head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/a11y-dark.min.css">
	<meta charset="utf-8">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
	<script>hljs.highlightAll();</script>
<style>

:root {
    --base-font-size: 18px;
    --heading-multiplier: 1.5;
    
    --main-font: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
    --alt-font: 'JetBrains Mono', 'Source Code Pro', monospace;

    /* Rust-themed colors - inspired by Rust orange and dark themes */
    --rust-primary: #DEA584;        /* Rust orange/brown */
    --rust-secondary: #B7410E;      /* Darker rust */
    --rust-accent: #FF7F50;         /* Coral/orange accent */
    --rust-hover: #FFA07A;          /* Light salmon */
    --rust-visited: #CD5B45;        /* Tomato red */
    --rust-glow: rgba(222, 165, 132, 0.4);
    --terminal-link: #83C092;       /* Softer green that complements rust colors */
    
    /* Updated color scheme */
    --main-bg: #1A1A1A;            /* Dark gray instead of pure black */
    --secondary-bg: #252525;        /* Slightly lighter dark gray */
    --text-primary: #E8E8E8;
    --text-secondary: #B0B0B0;
    --glitch-color1: #DEA584;       /* Rust color for glitch */
    --glitch-color2: #83C092;       /* Terminal green for glitch */
}

img {
  max-width: 900px;
  width: auto;
  height: auto;
}

body {
    background-color: var(--main-bg);
    color: var(--text-primary);
    font-family: var(--main-font);
    line-height: 1.7;
    font-size: 18px;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
}

h1, h2, h3 {
    color: var(--text-primary);
    font-weight: 600; /* Slightly bolder for better readability */
    text-transform: uppercase;
    letter-spacing: 2px;
    font-family: var(--alt-font);
}

h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    position: relative;
    display: inline-block;
    color: var(--rust-primary);
}

h1::after {
    content: '_';
    animation: blink 1s step-end infinite;
    color: var(--rust-accent);
    margin-left: 5px;
}

.rust-crab {
    display: inline-block;
    margin-left: 10px;
    font-size: 1.8rem;
    animation: crab-walk 3s ease-in-out infinite;
}

@keyframes crab-walk {
    0%, 100% { transform: translateX(0) rotate(0deg); }
    25% { transform: translateX(5px) rotate(-5deg); }
    75% { transform: translateX(-5px) rotate(5deg); }
}

@keyframes blink {
    from, to { opacity: 0; }
    50% { opacity: 1; }
}

nav {
    background-color: rgba(37, 37, 37, 0.95); /* Using secondary bg with transparency */
    backdrop-filter: blur(5px);
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid var(--rust-primary);
}

nav ul {
    display: flex;
    justify-content: center;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 2rem;
}

main {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 2rem;
}

footer {
    text-align: center;
    padding: 2rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
    border-top: 1px solid var(--rust-primary);
    background-color: var(--secondary-bg);
}

/* Enhanced glitch effect with rust colors */
.glitch {
    position: relative;
}


/* Terminal-like elements with rust theme */
.terminal {
    background-color: var(--secondary-bg);
    border: 1px solid var(--rust-primary);
    padding: 1rem;
    font-family: var(--main-font);
    position: relative;
    margin: 2rem 0;
    border-radius: 4px;
    box-shadow: 0 0 15px var(--rust-glow);
}

.terminal::before {
    content: '$';
    position: absolute;
    left: 0.5rem;
    top: 0.5rem;
    color: var(--rust-accent);
    font-weight: bold;
}

.terminal p {
    margin: 0;
    padding-left: 1.5rem;
    color: var(--text-secondary);
}

/* Cargo.toml style code block */
.code-block {
    background-color: #2D2D2D;
    border-left: 4px solid var(--rust-primary);
    padding: 1rem;
    margin: 1.5rem 0;
    font-family: var(--main-font);
    font-size: 0.9rem;
    overflow-x: auto;
}

.code-key { color: #83C092; }      /* Green for keys */
.code-string { color: #D19A66; }   /* Orange for strings */
.code-comment { color: #5C6370; }  /* Gray for comments */
.code-number { color: #D19A66; }   /* Orange for numbers */

/* Responsive design */
@media (max-width: 768px) {
    nav ul {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    h1 {
        font-size: 1.8rem;
    }
}

a {
    color: var(--rust-accent);
    text-decoration: none;
    position: relative;
    font-weight: bold;
    transition: all 0.3s ease;
    padding: 0 2px;
}

a:hover {
    color: var(--rust-hover);
    text-shadow: 0 0 8px var(--rust-glow);
    background-color: rgba(222, 165, 132, 0.1);
}

/* Underline animation */
a::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 2px;
    bottom: -2px;
    left: 0;
    background: linear-gradient(90deg, var(--rust-accent), transparent);
    transform: scaleX(0);
    transform-origin: bottom right;
    transition: transform 0.4s ease;
}



/* Visited links */
a:visited {
    color: var(--rust-visited);
}

/* Active/focused links */
a:active, a:focus {
    color: var(--text-primary);
    outline: 1px dotted var(--rust-accent);
    background-color: rgba(222, 165, 132, 0.2);
}

/* Special link styles for navigation */
nav a {
    padding: 0.5rem 1rem;
    border: 1px solid transparent;
    transition: all 0.3s ease;
}

nav a:hover {
    border: 1px solid var(--rust-accent);
    background-color: rgba(222, 165, 132, 0.15);
    border-radius: 3px;
}

nav a::after {
    display: none;
}

/* Terminal-style links */
.terminal a {
    color: var(--terminal-link);
}

.terminal a:hover {
    color: #A7D8B9;
    text-shadow: 0 0 5px rgba(131, 192, 146, 0.5);
}

.terminal a::after {
    background: linear-gradient(90deg, var(--terminal-link), transparent);
}

.center-image {
    display: flex;
    justify-content: center;
    position: relative;
}

.center-image img {
    width: 150px;
}

blockquote {
    font-family: var(--alt-font);
    font-size: 1.2rem;
    color: var(--text-secondary);
    border-left: 3px solid var(--rust-primary);
    background: rgba(37, 37, 37, 0.5);
    padding: 1.5rem 2rem;
    margin: 2rem 0;
    position: relative;
    line-height: 1.8;
    border-radius: 0 4px 4px 0;
    box-shadow: 0 0 15px rgba(222, 165, 132, 0.1);
    overflow: hidden;
}

blockquote::before {
    content: '//';
    font-family: var(--main-font);
    font-size: 1.5rem;
    color: var(--rust-glow);
    position: absolute;
    left: 0.5rem;
    top: 0.5rem;
    line-height: 1;
    opacity: 0.5;
}

blockquote::after {
    content: '';
    position: absolute;
    right: 0;
    bottom: 0;
    width: 30%;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--rust-primary), transparent);
}

blockquote p {
    margin: 0;
    position: relative;
    z-index: 1;
}

blockquote footer {
    font-size: 0.9rem;
    text-align: right;
    margin-top: 1rem;
    color: var(--rust-accent);
    font-style: normal;
    border: none;
    background: none;
}

blockquote footer::before {
    content: '— ';
}


img {
    filter: brightness(0.8) contrast(1.1) sepia(0.1);
    transition: filter 0.4s ease;
}


/* Rust specific status indicators */
.status-compiling {
    color: var(--rust-primary);
    animation: pulse 2s infinite;
}

.status-success {
    color: var(--terminal-link);
}

.status-error {
    color: var(--rust-secondary);
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

</style>
  <title>Visualizing Metrics </title>

  </head>
  <body class="hack main container">
	<a href="https://elias.sh">< back to home</a>
	<main>
	<h1>Visualizing Metrics</h1>
	<h6>2023-06-27</h6>
	<p>The last project I worked on at my job was a data visualization system, specifically a metrics dashboard. Although my role was primarily on the back-end, I still provided input on the user experience for SREs (Front-End development of the system) and also to guide SREs on how to better use the new system. I didn't want to rely solely on my personal experiences, so I sought a more theoretical foundation. In this post, I will share some of my notes. Most of these notes were taken from &quot;Better Data Visualizations&quot; by Jonathan Schwabish, or from my own notes during the <a href="https://ic.unicamp.br/en/~mdc/">Complex Data Mining</a> course.</p>
<h2>What do we need to avoid?</h2>
<p>When building a dashboard to display the health of a system, it's important to avoid spaghetti charts. These charts are difficult to read and should be avoided, especially since the dashboard may be used by people during late hours. Do you really want a tired person to try and make sense of a chart like this bellow?</p>
<p><img src="/visualizing_metrics/Untitled.png" alt="Untitled" /></p>
<p>Following any of those timeseries can be challenging. One approach, suggested by Jonathan Schwabish, is to break the chart into multiple smaller versions. For instance, if you're displaying CPU usage on machines, you could break it down by AZ or region. Alternatively, you might want to filter the timeseries to focus only on those with big changes in the last few minutes.</p>
<p>Pie charts are generally not recommended. Schwabish explains that humans struggle to compare slices of different sizes easily (refer to the chart below to see which one clearly shows the proportion of each company's revenue). Although there are cases where it’s acceptable to use pie charts, such as when the slices are of known proportions (e.g. 50%-50%; 25%-25%-25%-25%), we are specifically discussing metrics and creating a useful dashboard for SREs. Since the data will be dynamic, you want your engineers to be able to quickly scan the dashboard and get a sense of what is wrong. Parsing a pie chart takes time and may lead to the wrong conclusion. Therefore, it is best to avoid using them.</p>
<p><img src="/visualizing_metrics/Untitled%201.png" alt="Untitled" /></p>
<p>(Image from <a href="https://towardsdatascience.com/the-case-against-the-pie-chart-43f4c3fccc6">https://towardsdatascience.com/the-case-against-the-pie-chart-43f4c3fccc6</a> )</p>
<p>Another point to avoid is relying solely on the average. Depending on the distribution of your data, it may mislead you. A great article on this topic can be found at <a href="https://towardsdatascience.com/avoid-troubles-with-average-923012d1cd3e">Towards Data Science</a>.</p>
<p>For metrics, you are probably not interested in averages, but rather in values such as p90, p99, or max/min.</p>
<h2>Accessible dashboards</h2>
<p>In our industry, many people assume that certain things are &quot;obvious&quot; and don't bother explaining them. As a result, engineers who are unfamiliar with the subject may be too hesitant to ask questions. This can lead to chaos and confusion.</p>
<p>All charts on a dashboard should include explanations, so that anyone, even someone from another team, can understand what is happening. This is especially important because during an outage at 3 AM, other teams may check your dashboard to determine whether your service is the cause of the issue, or if it has also been affected.</p>
<p>It's also useful to include a link to a runbook that explains what to do if the metrics are abnormal and how to debug the issue. This is helpful not only for other teams, but also for your own SREs.</p>
<p>Be cautious of the colors you use on your dashboard, as some colorblind individuals may be misled by certain colors.</p>
<p>While this document focuses on the people creating the dashboards, it's worth noting that the dashboard system should also be accessible to screen-readers. Whatever system you use, it should support screen-readers.</p>
<h2>Line Charts</h2>
<p>Line charts are the most common type of chart used for metric visualization. They are great because they allow you to quickly see the behavior of a time series within a specified time window. Additionally, you can add threshold lines to indicate what normal behavior should look like.</p>
<h2>Beyond your line chart</h2>
<p>Line charts are a great way to visually represent data and are my go-to choice almost all of the time. However, there are instances when they may not be sufficient for quickly grasping an overview of a system. In such cases, heatmaps are an excellent alternative. Heatmaps use colors and color saturations to represent data values, creating a 3D chart that is particularly useful for high-frequency data or when understanding general patterns is more important than exact values.</p>
<p>For example, we are mapping the duration_ms over time and the frequency of those values below:</p>
<p><img src="/visualizing_metrics/Untitled%202.png" alt="Untitled" /></p>
<h2>Group your data with meaningful tags</h2>
<p>When creating your dashboard, consider using tags such as region, service, and http_status. This makes it easy to filter results and identify issues. Additionally, using tags instead of hardcoding IPs allows you to change your fleet without worrying about updating dashboards. This makes maintaining your dashboard up-to-date effortless.</p>
<h2>The end</h2>
<p>In conclusion, building a metrics dashboard system requires careful consideration of the UX for SREs. Avoiding confusing chart types such as spaghetti charts and pie charts, making explanations and playbooks accessible, and using meaningful tags are all important steps to creating a useful and effective dashboard. Line charts are a common chart type, but heatmaps can also be useful for high-frequency data or when seeing general patterns are more important than exact values. Ultimately, a well-designed dashboard can help teams quickly identify and respond to issues in their systems.</p>
	</main>
        <div class="footer">
      Built with <a href="https://github.com/era/tinylang">TinyLang</a> + <a href="https://github.com/era/squid">Squid</a>.
    </div>

  </body>
</html>
